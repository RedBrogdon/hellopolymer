<link rel="import" href="../hello-card/hello-card.html">
<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../../bower_components/core-pages/core-pages.html">
<link rel="import" href="../../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../../bower_components/paper-radio-group/paper-radio-group.html">

<core-style id="hello-newswire-card">

  .cardFace {
    padding: 10px;
  }

  img {
    height: 60px;
    margin: -12px;
  }

  table {
    width: 100%;
  }

  h1 {
    font-weight: 300;
  }

  .newswireLink {
    display: block;
    padding-bottom: 5px;
  }

  core-pages {
    min-height: 190px;
  }

</core-style>

<polymer-element extends="hello-card" name="hello-newswire-card">
  <template>
    <shadow></shadow>
    <core-style ref="hello-newswire-card"></core-style>
    <core-ajax on-core-error="{{ handleAjaxError }}" on-core-response="{{ handleAjaxResponse }}"
      auto url="/info/NYTNewswire" handleAs="json" id="ajaxNewswire"></core-ajax>

    <div class="cardFace">
      <core-pages id="articlePages" selected="{{ selectedPage }}">
        <div>
          <template repeat="{{ article in articles[0] }}">
            <a class="newswireLink" target="_blank" href="{{ article.url}}" title="{{ article.abstract }}">{{ article.title }}</a>
          </template>
        </div>
        <div>
          <template repeat="{{ article in articles[1] }}">
            <a class="newswireLink" target="_blank" href="{{ article.url}}" title="{{ article.abstract }}">{{ article.title }}</a>
          </template>
        </div>
        <div>
          <template repeat="{{ article in articles[2] }}">
            <a class="newswireLink" target="_blank" href="{{ article.url}}" title="{{ article.abstract }}">{{ article.title }}</a>
          </template>
        </div>
        <div>
          <template repeat="{{ article in articles[3] }}">
            <a class="newswireLink" target="_blank" href="{{ article.url}}" title="{{ article.abstract }}">{{ article.title }}</a>
          </template>
        </div>
      </core-pages>

      <paper-radio-group selected="{{ selectedPage }}">
        <paper-radio-button on-click="{{ radioClickHandler }}"></paper-radio-button>
        <paper-radio-button on-click="{{ radioClickHandler }}"></paper-radio-button>
        <paper-radio-button on-click="{{ radioClickHandler }}"></paper-radio-button>
        <paper-radio-button on-click="{{ radioClickHandler }}"></paper-radio-button>
      </paper-radio-group>
    </div>
  </template>

  <script>

    Polymer('hello-newswire-card', {

      ready: function() {
        this.titleText = 'NYT Newswire';
        this.selectedPage = 0;
        this.carouselRunning = true;
        this.super();
        this.async(this.stepCarousel, null, 5000);
      },

      handleAjaxResponse: function(e) {
        this.articles = [];
        var i;

        for (i = 0; i < 4; i++) {
          this.articles.push([]);
        }

        for (i = 0; i < Math.min(20, e.detail.response.length); i++) {
          this.articles[Math.floor(i / 5)].push(e.detail.response[i]);
        }
      },

      handleAjaxError: function(e) {
        alert('Failed to load newswire.');
      },

      showNextPage: function() {
        this.$.articlePages.selected = (this.$.articlePages.selected + 1) % this.$.articlePages.children.length;
      },

      radioClickHandler: function() {
        this.carouselRunning = false;
      },

      stepCarousel: function() {
        if (this.carouselRunning) {
          this.selectedPage = (this.selectedPage + 1) % this.$.articlePages.children.length
          this.async(this.stepCarousel, null, 5000);
        }
      }
    });

  </script>

</polymer-element>
